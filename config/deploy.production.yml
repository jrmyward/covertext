# Production deployment configuration
# Use: kamal deploy -d production

# Deploy to production server
servers:
  web:
    hosts:
      - 5.6.7.8  # Replace with production server IP

volumes:
  - "/var/lib/covertext/production/db:/rails/db"
  - "/var/lib/covertext/production/storage:/rails/storage"

env:
  clear:
    RAILS_ENV: production
    APP_HOST: covertext.app
    APP_PROTOCOL: https
    SOLID_QUEUE_IN_PUMA: true
  secret:
    - RAILS_MASTER_KEY

# SSL configuration
proxy:
  ssl: true
  host: covertext.app

# Aliases are triggered with "kamal <alias>"
aliases:
  console: app exec --interactive --reuse "bin/rails console"
  shell: app exec --interactive --reuse "bash"
  logs: app logs -f
  dbc: app exec --interactive --reuse "bin/rails dbconsole"
  setup-volumes: host exec --hosts 5.6.7.8 "mkdir -p /var/lib/covertext/production/db /var/lib/covertext/production/storage && chown -R 1000:1000 /var/lib/covertext/production"
# Add: database: { url: "postgres://..." }
